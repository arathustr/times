<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Personal Times</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@4.15.0/dist/av-min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=UnifrakturMaguntia&display=swap');
        body { font-family: "Times New Roman", Times, serif; background-color: #f9f9f9; color: #1a1a1a; }
        .masthead-font { font-family: 'UnifrakturMaguntia', serif; }
        .headline-font { font-family: 'Libre Baskerville', serif; }
        .sans-font { font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .animate-fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="selection:bg-black selection:text-white min-h-screen">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
        const { useState, useEffect } = React;

        // LeanCloud 配置 (只读权限)
        const LEANCLOUD_CONFIG = {
            appId: "BSxRnkRaWIbzt7TsiimZcZvF-gzGzoHsz",
            appKey: "EsCNZiqtD1VSWkIgtvrPdocp",
            serverURL: "https://bsxrnkra.lc-cn-n1-shared.com"
        };

        try {
            AV.init({
                appId: LEANCLOUD_CONFIG.appId,
                appKey: LEANCLOUD_CONFIG.appKey,
                serverURL: LEANCLOUD_CONFIG.serverURL
            });
        } catch (e) { console.error("LeanCloud Init Error:", e); }

        const NewspaperHeader = () => {
            const dateStr = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            return (
                <header className="border-b-4 border-black mb-8">
                    <div className="flex justify-between items-center py-1 text-xs sans-font border-b border-gray-300 uppercase tracking-widest text-gray-500">
                        <span>Vol. 1, No. 1</span>
                        <span>{dateStr}</span>
                        <span>$1.00</span>
                    </div>
                    <div className="text-center py-8 relative">
                        <h1 className="text-5xl md:text-7xl lg:text-8xl tracking-tight leading-none mb-4 masthead-font">
                            The Personal Times
                        </h1>
                        <p className="italic text-lg text-gray-600 headline-font">"All the News That's Fit to Print (About Me)"</p>
                    </div>
                    <div className="border-t-2 border-b-2 border-black py-2 mb-1 flex justify-center space-x-8 text-sm font-bold uppercase tracking-widest overflow-x-auto sans-font">
                        {['World', 'Tech', 'Life', 'Opinion', 'Arts'].map(cat => (
                            <span key={cat} className="cursor-pointer hover:underline">{cat}</span>
                        ))}
                    </div>
                </header>
            );
        };

        const ArticleCard = ({ post }) => (
            <article className="mb-8 border-b border-gray-200 pb-8 group animate-fade-in">
                <div className="grid grid-cols-1 md:grid-cols-12 gap-6">
                    <div className="md:col-span-8">
                        <div className="mb-2 flex items-center gap-2">
                            <span className="text-xs sans-font font-bold uppercase tracking-widest text-gray-500 border border-gray-300 px-1 py-0.5">{post.category || 'General'}</span>
                        </div>
                        <h2 className="text-3xl md:text-4xl font-bold leading-tight mb-3 hover:text-gray-700 transition-colors cursor-pointer headline-font tracking-tight">{post.title}</h2>
                        <div className="text-sm sans-font text-gray-500 mb-4 flex items-center gap-2">
                            <span className="font-bold text-gray-900 uppercase">By {post.author || 'The Editor'}</span>
                            <span>•</span>
                            <span>{post.createdAt ? new Date(post.createdAt).toLocaleDateString() : 'Published'}</span>
                        </div>
                        <p className="text-lg leading-relaxed text-gray-900 text-justify mb-4 whitespace-pre-line">{post.excerpt || (post.content ? post.content.substring(0, 150) + '...' : '')}</p>
                    </div>
                    {post.imageUrl && (
                        <div className="md:col-span-4">
                            <div className="aspect-[4/3] bg-gray-100 overflow-hidden border border-gray-300 relative shadow-sm">
                                <img src={post.imageUrl} alt={post.title} className="w-full h-full object-cover filter grayscale hover:grayscale-0 transition-all duration-500" />
                                <div className="absolute bottom-0 left-0 right-0 bg-white/80 p-1 text-[10px] sans-font text-gray-500 text-center border-t border-gray-200">Fig 1. Visual representation</div>
                            </div>
                        </div>
                    )}
                </div>
            </article>
        );

        const App = () => {
            const [posts, setPosts] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const fetchPosts = async () => {
                    try {
                        const query = new AV.Query('BlogPost');
                        query.descending('createdAt');
                        const results = await query.find();
                        setPosts(results.map(item => ({
                            id: item.id,
                            ...item.attributes,
                            createdAt: item.createdAt
                        })));
                    } catch (error) { console.error(error); } 
                    finally { setLoading(false); }
                };
                fetchPosts();
            }, []);

            return (
                <div className="max-w-6xl mx-auto px-4 py-4">
                    <NewspaperHeader />
                    {loading ? (
                        <div className="py-20 text-center italic text-gray-400">Fetching the latest edition...</div>
                    ) : posts.length === 0 ? (
                        <div className="py-20 text-center border-4 border-double border-gray-200 p-10">
                            <h2 className="text-3xl mb-4 headline-font">Extra! Extra!</h2>
                            <p className="text-gray-500 mb-6">No stories available.</p>
                        </div>
                    ) : (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12">
                            {posts.map(p => <ArticleCard key={p.id} post={p} />)}
                        </div>
                    )}
                    <footer className="mt-20 border-t-4 border-black pt-8 pb-12 text-center">
                        <div className="masthead-font text-3xl mb-4">The Personal Times</div>
                        <p className="text-xs sans-font text-gray-500 uppercase tracking-widest">© {new Date().getFullYear()} Private Edition.</p>
                    </footer>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
